---
templateKey: PodCast
channel: test
title: お久しぶりです
date: 2020-03-05T15:35:30.405Z
slug: ohisa
description: ずいぶん間が空きました
---
## お久しぶりです

ずいぶん間が空きましたが、この間何をしていたかと言うと、マークダウンから音声に変換する部分を丸っきり書き換えていました。

そこそこ満足感のある仕上がりではあったのですが、Text to Speech のAPI が5000文字制限だと気が付いたのが事の発端です。

これは原稿のキャラクター数ではなかなかのボリュームと言えるかもしれませんが、それをSSMLに変換すると結構膨張するのです。

結果的にPodcastとしてはかなりショートなエピソードしか配布できないという事になります。\
これはちょっとおもしろくありません。

## 分割して処理することにした

まぁ、一度にリクエストできる上限が決まっているなら、分割して処理するしかありません。

今回はヘッダー要素で分割して処理し、後に結合することにしました。\
実はこれも完全な解決には至っていません。\
なぜなら、それでも5000文字以上のセクションが作りえるからです。

何に苦労して時間がかかったかというと、音声ファイルの連結です。

## FFmpeg

開発言語には Javascript + Node.js を使っています。\
というか、プラットフォームが Gatsby ですから。

バイナリデータが扱えると言えども、Mpeg3 の仕様を読み解いて連結するというのは、かなりムリげーです。

FFmpeg というライブラリは知っていましたが、はたして Node.js 環境でどう動かすかには知見がありませんでした。

ましてや、Netlify CMS を使うのでさほど自由度もありません。

悩んでいると、FFmpeg を node_module 内にインストールするライブラリを発見したので、それを利用します。OSを判断して適切なインストーラーを選択してくれるという優れもので、Node.js からパイプするパスも取得できるというものです。

成果としては、変時点では8分以上のエピソード生成に成功しています。

## とはいえ

そうした作り直しをしたおかげで、長いエピソードが可能になった反面、Podcast 番組としてのクオリティは振り出しに戻りました。

BGM や SE はかなりいい加減にしてしまったのでブラッシュアップが必要です。

ただ、もう何度もリファクタしてきたので、かなりロジックが整理されました。

## 明日は

仕事で予定していたリリースの社内レビューの結果が、結構クリティカルな指摘があって、対応会議というちょっと憂鬱なイベントがある。

経緯としてはマズい部分もあったので、へこたれず次に活かそう。\
正念場だ。

では、おやすみなさい
